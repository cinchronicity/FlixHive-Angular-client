<div class="user-profile-container">
  <mat-card class="profile-card">
    <mat-card-header>
      <!-- <mat-card-title>User Profile</mat-card-title> -->
      <div class="header-actions">
        <button mat-icon-button routerLink="/movies" matTooltip="Back to Movies">
          <mat-icon>movie</mat-icon>
        </button>
        <button mat-icon-button (click)="logout()" matTooltip="Logout">
          <mat-icon>logout</mat-icon>
        </button>
      </div>
    </mat-card-header>

    <mat-card-content>
      <!-- Profile Information Display/Edit -->
      <div class="profile-section">
        <h3>Profile Information</h3>

        <div *ngIf="!isEditing" class="view-mode">
          <div class="profile-field">
            <label>Username:</label>
            <span>{{ user?.username || 'No username found' }}</span>
          </div>
          <div class="profile-field">
            <label>Email:</label>
            <span>{{ user?.email || 'No email found' }}</span>
          </div>
          <div class="profile-field">
            <label>Birthday:</label>
            <span>{{ user?.birthdate ? (user.birthdate | date:'shortDate') : 'No birthday found' }}</span>
          </div>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="enableEdit()">
              <mat-icon>edit</mat-icon>
              Edit Profile
            </button>
            <button mat-raised-button color="warn" (click)="deleteUser()">
              <mat-icon>delete</mat-icon>
              Delete Account
            </button>
          </div>
        </div>

        <div *ngIf="isEditing" class="edit-mode">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Username</mat-label>
            <input matInput [(ngModel)]="userData.Username" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput type="email" [(ngModel)]="userData.Email" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Password (leave blank to keep current)</mat-label>
            <input matInput type="password" [(ngModel)]="userData.Password">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Birthday</mat-label>
            <input matInput type="date" [(ngModel)]="userData.Birthday">
          </mat-form-field>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="updateUser()">
              <mat-icon>save</mat-icon>
              Save Changes
            </button>
            <button mat-raised-button (click)="cancelEdit()">
              <mat-icon>cancel</mat-icon>
              Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Favorite Movies Section -->
      <div class="favorites-section">
        <h3>Favorite Movies</h3>
        <div *ngIf="favoriteMovies.length === 0" class="no-favorites">
          <p>No favorite movies yet. Start exploring movies to add them to your favorites!</p>
        </div>

        <div *ngIf="favoriteMovies.length > 0" class="favorites-grid">
          <mat-card *ngFor="let movie of favoriteMovies" class="movie-card">
            <mat-card-header>
              <mat-card-title>{{ movie.title }}</mat-card-title>
              <button mat-icon-button (click)="removeFavorite(movie._id)" matTooltip="Remove from favorites">
                <mat-icon>favorite</mat-icon>
              </button>
            </mat-card-header>
            <img mat-card-image [src]="movie.imageURL" [alt]="movie.title" *ngIf="movie.imageURL">
            <mat-card-content>
              <p><strong>Director:</strong> {{ movie.director?.name }}</p>
              <p><strong>Genre:</strong> {{ movie.genre?.name }}</p>
              <p><strong>Rating:</strong> {{ movie.rating }}/10</p>
              <p class="description">{{ movie.description }}</p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>